# CleanSlate API Research Documentation

## Research Date
2025-10-20

## Research Status
**IMPORTANT**: Unable to access actual CleanSlate API documentation directly. The following is based on spec assumptions and standard REST API patterns. This implementation will require verification and adjustment once actual API documentation is available.

## Assumed API Details

### Base URL
**Assumed**: `https://api.cleanslate.sh/v1`

**Rationale**: Standard pattern for versioned REST APIs. The spec mentions cleanslate.sh as the website, and v1 indicates first API version.

**Verification Needed**: Confirm actual base URL from CleanSlate documentation or support.

### Authentication Method
**Assumed**: Bearer Token Authentication

**Implementation**:
```
Authorization: Bearer {API_KEY}
```

**Rationale**: Most modern REST APIs use Bearer tokens for API authentication. This is the standard mentioned in the spec.

**Verification Needed**: Confirm authentication method. Alternatives could include:
- API Key in custom header (e.g., `X-API-Key`)
- Basic authentication
- OAuth 2.0

### Required Endpoints

Based on the spec requirements, the following endpoints are assumed:

#### 1. Create Food Entry
**Endpoint**: `POST /food-entries`

**Request Headers**:
```
Authorization: Bearer {API_KEY}
Content-Type: application/json
```

**Request Body**:
```json
{
  "name": "Chicken breast",
  "calories": 165,
  "protein": 31
}
```

**Success Response** (201 Created):
```json
{
  "entry": {
    "id": "550e8400-e29b-41d4-a716-446655440000",
    "name": "Chicken breast",
    "calories": 165,
    "protein": 31,
    "timestamp": "2025-10-20T14:30:00Z"
  }
}
```

**Notes**:
- Timestamp likely auto-generated by server (current time in UTC)
- Entry ID is UUID format
- Entry automatically tagged with "today's date"

#### 2. Get Today's Log
**Endpoint**: `GET /food-entries/today`

**Request Headers**:
```
Authorization: Bearer {API_KEY}
```

**Success Response** (200 OK):
```json
{
  "entries": [
    {
      "id": "550e8400-e29b-41d4-a716-446655440000",
      "name": "Scrambled eggs",
      "calories": 140,
      "protein": 12,
      "timestamp": "2025-10-20T08:15:00Z"
    },
    {
      "id": "550e8400-e29b-41d4-a716-446655440001",
      "name": "Chicken breast",
      "calories": 165,
      "protein": 31,
      "timestamp": "2025-10-20T14:30:00Z"
    }
  ]
}
```

**Empty Log Response** (200 OK):
```json
{
  "entries": []
}
```

**Notes**:
- "Today" is likely calculated on server-side based on user's timezone or UTC
- Returns all entries for the current day
- Ordered by timestamp (earliest first assumed)

#### 3. Delete Food Entry
**Endpoint**: `DELETE /food-entries/:id`

**Example**: `DELETE /food-entries/550e8400-e29b-41d4-a716-446655440000`

**Request Headers**:
```
Authorization: Bearer {API_KEY}
```

**Success Response** (200 OK or 204 No Content):
```json
{
  "success": true
}
```

**Alternative**: 204 No Content (no body)

**Notes**:
- Entry ID is UUID from the food entry
- May only allow deletion of today's entries (aligned with daily reset philosophy)

#### 4. Update Food Entry
**Endpoint**: `PATCH /food-entries/:id`

**Example**: `PATCH /food-entries/550e8400-e29b-41d4-a716-446655440000`

**Request Headers**:
```
Authorization: Bearer {API_KEY}
Content-Type: application/json
```

**Request Body** (partial update):
```json
{
  "calories": 180
}
```

**Success Response** (200 OK):
```json
{
  "entry": {
    "id": "550e8400-e29b-41d4-a716-446655440000",
    "name": "Chicken breast",
    "calories": 180,
    "protein": 31,
    "timestamp": "2025-10-20T14:30:00Z"
  }
}
```

**Notes**:
- PATCH allows partial updates (only send fields to change)
- Timestamp likely remains original, not updated
- May only allow updates to today's entries

#### 5. Get Today's Summary
**Endpoint**: `GET /food-entries/today/summary`

**Request Headers**:
```
Authorization: Bearer {API_KEY}
```

**Success Response** (200 OK):
```json
{
  "totalCalories": 305,
  "totalProtein": 43,
  "entryCount": 2
}
```

**Empty Log Response** (200 OK):
```json
{
  "totalCalories": 0,
  "totalProtein": 0,
  "entryCount": 0
}
```

**Notes**:
- Server-side calculation of totals
- Returns zeros for empty log (not an error)

### Error Response Format

**Standard Error Format** (assumed):
```json
{
  "error": "ValidationError",
  "message": "Calories must be between 0 and 10000"
}
```

### HTTP Status Codes

**Success Codes**:
- `200 OK`: Successful GET, PATCH, DELETE
- `201 Created`: Successful POST (create)
- `204 No Content`: Successful DELETE (alternative)

**Client Error Codes**:
- `400 Bad Request`: Validation errors (invalid calories, missing required fields)
- `401 Unauthorized`: Missing or invalid API key
- `403 Forbidden`: Valid API key but insufficient permissions
- `404 Not Found`: Entry ID doesn't exist or was already deleted
- `422 Unprocessable Entity`: Semantic validation errors (alternative to 400)

**Server Error Codes**:
- `500 Internal Server Error`: Generic server failure
- `502 Bad Gateway`: Upstream service unavailable
- `503 Service Unavailable`: Temporary service disruption
- `504 Gateway Timeout`: Request timeout

### Rate Limiting

**Assumed Headers** (to be confirmed):
```
X-RateLimit-Limit: 100
X-RateLimit-Remaining: 95
X-RateLimit-Reset: 1634745600
```

**Assumed Limits**:
- 100 requests per minute per API key
- 1000 requests per hour per API key

**Rationale**: Standard rate limiting for API services

**Verification Needed**: Check actual rate limits in API documentation

### Request Timeout
**Assumed**: 10 seconds

**Rationale**: Spec mentions 10-second timeout. This is reasonable for simple CRUD operations.

### Content Type
**Request**: `application/json`
**Response**: `application/json`

## Implementation Assumptions

Based on this research, the API client implementation will:

1. **Use Bearer Token Authentication**: All requests include `Authorization: Bearer {API_KEY}` header
2. **Use Native Fetch API**: Node.js 18+ native fetch for HTTP requests (no axios/got dependencies)
3. **Handle Standard REST Conventions**: POST for create, GET for read, PATCH for update, DELETE for delete
4. **Parse JSON Responses**: Expect all responses in JSON format
5. **Map Status Codes to Errors**:
   - 401/403 → AuthenticationError
   - 400/422 → ValidationError
   - 404 → NotFoundError
   - 5xx → ApiError
   - Network failures → NetworkError
6. **Implement Retry Logic**: Single retry with 1-second delay for network failures
7. **Use 10-Second Timeout**: Abort requests after 10 seconds

## Deviations from Spec Assumptions

None at this time. All endpoint structures match spec assumptions exactly.

## Verification Checklist

Before production deployment, verify:

- [ ] Base URL is correct (`https://api.cleanslate.sh/v1` or different?)
- [ ] Authentication header format (Bearer token vs custom header)
- [ ] Exact endpoint paths (especially plural vs singular: `/food-entries` vs `/food-entry`)
- [ ] Request/response field names (camelCase vs snake_case)
- [ ] Error response structure
- [ ] Rate limiting headers and limits
- [ ] Timezone handling for "today" (UTC vs user timezone)
- [ ] Whether DELETE returns 200 or 204
- [ ] Whether entry IDs are UUIDs or different format

## Contact for API Documentation

**Recommended Actions**:
1. Check CleanSlate website (cleanslate.sh) for developer documentation
2. Contact CleanSlate support for API documentation
3. Request API sandbox/testing credentials
4. Review any existing API client libraries they may provide

## Testing Strategy

Until actual API is available:
1. **Mock all API responses** in unit tests
2. **Use test fixtures** matching assumed response formats
3. **Implement flexible parsing** to handle minor format differences
4. **Add extensive error handling** for unexpected response structures
5. **Create integration test suite** to run against real API once available

## Change Log

- **2025-10-20**: Initial research document created based on spec assumptions
- **Future**: Update with actual API documentation once available
